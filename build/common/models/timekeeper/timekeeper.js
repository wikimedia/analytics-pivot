"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var time_tag_1=require("../time-tag/time-tag");var Timekeeper=function(e){tslib_1.__extends(t,e);function t(t){return e.call(this,t)||this}t.isTimekeeper=function(e){return e instanceof t};t.globalNow=function(){return new Date};t.fromJS=function(e){return new t(immutable_class_1.BaseImmutable.jsToValue(t.PROPERTIES,e))};t.prototype.now=function(){return this.nowOverride||t.globalNow()};t.prototype.hasTime=function(e){var t=immutable_class_1.NamedArray.findByName(this.timeTags,e);return Boolean(t&&t.time)};t.prototype.getTime=function(e){var t=immutable_class_1.NamedArray.findByName(this.timeTags,e);if(!t)return this.now();return t.time||this.now()};t.prototype.touch=function(e){var a=this.valueOf();var i=immutable_class_1.NamedArray.findByName(a.timeTags,e);if(!i)return this;a.timeTags=immutable_class_1.NamedArray.overrideByName(a.timeTags,i.touch(this.now()));return new t(a)};t.prototype.addOrUpdateTimeTagFor=function(e,a){if(a===void 0){a=null}var i=this.valueOf();var r=immutable_class_1.NamedArray.findByName(i.timeTags,e);if(r){r=r.changeTime(a,this.now())}else{r=new time_tag_1.TimeTag({name:e,time:a,updated:this.now()})}i.timeTags=immutable_class_1.NamedArray.overrideByName(i.timeTags,r);return new t(i)};t.prototype.removeTimeTagFor=function(e){return this.changeTimeTags(immutable_class_1.NamedArray.deleteByName(this.timeTags,e))};t.prototype.getTimeTagsNotUpdatedSince=function(e){return this.timeTags.filter(function(t){return!t.updated||t.updated<e})};t.prototype.getTimeTagsWithoutTime=function(){return this.timeTags.filter(function(e){return!e.time})};return t}(immutable_class_1.BaseImmutable);Timekeeper.PROPERTIES=[{name:"timeTags",type:immutable_class_1.PropertyType.ARRAY,immutableClassArray:time_tag_1.TimeTag},{name:"nowOverride",type:immutable_class_1.PropertyType.DATE,defaultValue:null}];exports.Timekeeper=Timekeeper;immutable_class_1.BaseImmutable.finalize(Timekeeper);Timekeeper.EMPTY=new Timekeeper({timeTags:[]});