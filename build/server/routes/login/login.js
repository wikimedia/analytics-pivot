"use strict";var nike_hercules_1=require("@implydata/nike-hercules");var models_1=require("../../../common/models");var config_1=require("../../config");var COOKIE_MAX_AGE=config_1.SERVER_SETTINGS.getCookieMaxAge();var SHA_SALT=config_1.SERVER_SETTINGS.getShaSalt();var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(e,s,r){var t=e.body,o=t.name,n=t.pass,i=t.rememberMe;config_1.SETTINGS_MANAGER.getFullSettings({timeout:1e4}).then(function(r){if(!(typeof o==="string"&&typeof n==="string")){s.status(400).json({status:"BAD_REQUEST"});return}var t=r.appSettings;var u=t.getUsersAuth(config_1.SERVER_SETTINGS.getDefaultAdminPass());models_1.UserAuth.getValidUser(u,o,n,SHA_SALT).then(function(r){if(!r){e.session["error"]="BAD_AUTH";s.status(401).json({status:"BAD_AUTH"});return}var o=t.getUser(r.name);if(!o){e.session["error"]="COULD NOT FIND USER";s.status(500).json({status:"COULD NOT FIND USER"});return}e.session["loggedIn"]=true;e.session["user"]=o;if(i){e.session.cookie.maxAge=COOKIE_MAX_AGE}s.json({status:"OK"})})})});module.exports=router;