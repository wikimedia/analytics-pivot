"use strict";var nike_hercules_1=require("@implydata/nike-hercules");var models_1=require("../../../common/models");var config_1=require("../../config");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(e,r){var t=e.body,s=t.domain,a=t.dataCube,n=t.dataSource,u=t.essence;a=a||n;if(config_1.LICENSE_MANAGER.isExpired()){r.status(501).send({error:"evaluation expired"});return}if(typeof s!=="string"){r.status(400).send({error:"must have a domain"});return}if(typeof a!=="string"){r.status(400).send({error:"must have a dataCube"});return}if(typeof u!=="object"){r.status(400).send({error:"essence must be an object"});return}e.getFullSettings({dataCubeOfInterest:a}).then(function(e){var t=e.appSettings.getDataCube(a);if(!t){r.status(400).send({error:"unknown data cube"});return}var n;try{n=models_1.Essence.fromJS(u,{dataCube:t,visualizations:models_1.MANIFESTS})}catch(e){r.status(400).send({error:"invalid essence",message:e.message});return}r.json({url:s+"#"+n.getURL()})}).done()});module.exports=router;